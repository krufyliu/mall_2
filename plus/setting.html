<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/font-awesome.min.css" />
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../css/style.css" />
		<script>
			function imgLoaded(img) {
        var imgWrapper = img.parentNode;
        imgWrapper.className += imgWrapper.className? ' loaded' : 'loaded';
      }
			
		</script>
	</head>

	<body class="niceui setting">
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="setting" class="mui-page">
			<!--页面标题栏开始-->
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon"></span>
				</button>
				<h1 class="mui-center mui-title">我的</h1>
				<!--<button id="plus/barcode.html" class="mui-pull-right mui-btn-link"><i class="fa fa-qrcode fa-2x"></i></button>-->
			</div>
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell mui-media">
								<a class="mui-navigate-right" href="#account">
									<div class="img-mask-left"></div>
									<img class="mui-pull-left mui-media-object head-img mui-action-preview" id="head-img" src="../images/cler.png">
									<div class="mui-media-body">
										小帽
										<p class='mui-ellipsis'>茂号:&nbsp;<span id="account1"></span></p>
									</div>
								</a>
							</li>
						</ul>
						
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a href="#collect" class="mui-navigate-right"><span class="mui-icon fa fa-credit-card"></span>&nbsp;&nbsp;优惠券</a>
							</li>
							<li class="mui-table-view-cell">
								<a href="#heart" class="mui-navigate-right"><span class="mui-icon fa fa-heart"></span>&nbsp;&nbsp;收藏</a>
							</li>
						</ul>
						
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a href="#about" class="mui-navigate-right"><span class="mui-icon fa fa-hand-o-right"></span>&nbsp;&nbsp;关于茂号 <i class="mui-pull-right update">V1.0.0</i></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell" style="text-align: center;" id="exit">
								<a>立即登录</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>
		<!--单页面结束-->
		<div id="account" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>我的
				</button>
				<h1 class="mui-center mui-title">个人中心</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell">
							<a id="head" class="mui-navigate-right" href="#">
								<span style="line-height: 40px;">头像</span>
								<span class="mui-pull-right head">
									<img class="mui-media-object head-img mui-action-preview" id="head-img1" src="../images/cler.png"/>
									<div class="img-mask-right"></div>
								</span>
							</a>
						</li>
						<li class="mui-table-view-cell">
							<a>姓名<span class="mui-pull-right">小帽</span></a>
						</li>
						<li class="mui-table-view-cell">
							<a>茂号<span class="mui-pull-right" id="account2"></span></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
				
		<div id="collect" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>我的
				</button>
				<h1 class="mui-center mui-title">优惠券</h1>
			</div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<div class="container" style="margin-top:14px;">
						<div class="row" id="post-list">
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type" id="qcode.html?code=1" onclick="clicked(this.id);">点击使用</span>
					        <span class="name" id="merchant.html?shop=4" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type"  id="qcode.html?code=2" onclick="clicked(this.id);">点击使用</span>
					        <span class="name" id="merchant.html?shop=4" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect">
					        <div class="post-featured-image"></div>
					        <span class="type">已使用</span>
					        <span class="name" id="merchant.html?shop=4" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect">
					        <div class="post-featured-image"></div>
					        <span class="type">已过期</span>
					        <span class="name" id="merchant.html?shop=4" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>	
		
		<div id="heart" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>我的
				</button>
				<h1 class="mui-center mui-title">收藏</h1>
			</div>
			<div class="mui-page-content">
				<div class="">
					<div style="padding: 10px 10px;">
						<div id="segmentedControl" class="mui-segmented-control">
							<a class="mui-control-item mui-active" href="#item2">
								商城<span id="cont">(4)</span>
							</a>
							<a class="mui-control-item" href="#item3">
								店铺<span id="shop">(3)</span>
							</a>
						</div>
					</div>
					<div class="mui-scroll">
						<div>
							<div id="item2" class="mui-control-content mui-active">
								<ul id="OA_task_1" class="mui-table-view">
									<li class="mui-table-view-cell" id="grap.html?shop=1" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											大足印象
										</div>
									</li>
									<li class="mui-table-view-cell" id="grap.html?shop=1" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											茂田乐园
										</div>
									</li>
									<li class="mui-table-view-cell" id="grap.html?shop=2" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											加仑多卖场
										</div>
									</li>
									<li class="mui-table-view-cell" id="grap.html?shop=3" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											伦敦18区
										</div>
									</li>
								</ul>
							</div>
							<div id="item3" class="mui-control-content">
								<ul id="OA_task_2" class="mui-table-view">
									<li class="mui-table-view-cell" id="merchant.html?shop=1" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											肯德基
										</div>
									</li>
									<li class="mui-table-view-cell" id="merchant.html?shop=2" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											麦当劳
										</div>
									</li>
									<li class="mui-table-view-cell" id="merchant.html?shop=3" onclick="clicked(this.id);">
										<div class="mui-slider-right mui-disabled">
											<a class="mui-btn mui-btn-yellow mui-icon mui-icon-phone" href="tel:114"></a>
											<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
										</div>
										<div class="mui-slider-handle">
											一碗香
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="about" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>我的
				</button>
				<h1 class="mui-center mui-title">关于茂号</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a id="rate" class="mui-navigate-right">评分鼓励</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="welcome" class="mui-navigate-right">欢迎页</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="share" class="mui-navigate-right">分享推荐</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="tel" class="mui-navigate-right">客服电话</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="update" class="mui-navigate-right">检查更新</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

	</body>
	<script src="../js/mui.min.js "></script>
	<script src="../js/mui.view.js "></script>
	<script type="text/javascript" src="../js/app.js" ></script>
	<script>
		mui.init();
		 //初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#setting'
		});
		var act1 = document.getElementById('account1');
		var act2 = document.getElementById('account2');
		var state = app.getState();
		act1.innerText = state.account;
		act2.innerText = state.account;
		 //初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		
		
		var as='pop-in';// 默认窗口动画
			// 处理点击事件
		var _openw=null;
		function clicked(id,a,s){
			if(_openw){return;}
			a||(a=as);
			_openw=preate[id];
			if(_openw){
				_openw.showded=true;
				_openw.show(a,null,function(){
					_openw=null;//避免快速点击打开多个页面
				});
			}else{
				var wa=plus.nativeUI.showWaiting();
				_openw=plus.webview.create(id,id,{scrollIndicator:'none',scalable:false,popGesture:'hide'},{preate:true});
				preate[id]=_openw;
				_openw.addEventListener('loaded',function(){//叶面加载完成后才显示
					setTimeout(function(){//延后显示可避免低端机上动画时白屏
						wa.close();
						_openw.showded=true;
						s||_openw.show(a,null,function(){
							_openw=null;//避免快速点击打开多个页面
						});
						s&&(_openw=null);//避免s模式下变量无法重置
					},10);
				},false);
				_openw.addEventListener('close',function(){//页面关闭后可再次打开
					_openw=null;
					preate[id]&&(preate[id]=null);//兼容窗口的关闭
				},false);
			}
		}
		// 预创建二级页面
		var preate={};
		function preateWebviews(){
			preateWebivew('plus/grap.html');
			var plist=document.getElementById('plist').children;
			// 由于启动是预创建过多Webview窗口会消耗较长的时间，所以这里限制仅创建5个
			for( var i=0;i<plist.length&&i<2;i++){
				var id=plist[i].id;
				id&&(id.length>0)&&preateWebivew(id);
			}
		}
		function preateWebivew(id){
			if(!preate[id]){
				var w=plus.webview.create(id,id,{scrollIndicator:'none',scalable:false,popGesture:'hide'},{preate:true});
				preate[id]=w;
				w.addEventListener('close',function(){//页面关闭后可再次打开
					_openw=null;
					preate[id]&&(preate[id]=null);//兼容窗口的关闭
				},false);
			}
		}
		// 清除预创建页面(仅)
		function preateClear(){
			for(var p in preate){
				var w=preate[p];
				if(w&&w.showded&&!w.isVisible()){
					w.close();
					preate[p]=null;
				}
			}
		}
		
		 //分享操作
		var shares = {};
		mui.plusReady(function() {
			plus.share.getServices(function(s) {
				if (s && s.length > 0) {
					for (var i = 0; i < s.length; i++) {
						var t = s[i];
						shares[t.id] = t;
					}
				}
			}, function() {
				console.log("获取分享服务列表失败");
			});
			//defaultImg();
			setTimeout(function() {
				initImgPreview();
			}, 500);
		});
		 //分享链接点击事件
		document.getElementById("share").addEventListener('tap', function() {
			var ids = [{
					id: "weixin",
					ex: "WXSceneSession"
				}, {
					id: "weixin",
					ex: "WXSceneTimeline"
				}, {
					id: "sinaweibo"
				}, {
					id: "tencentweibo"
				}, {
					id: "qq"
				}],
				bts = [{
					title: "发送给微信好友"
				}, {
					title: "分享到微信朋友圈"
				}, {
					title: "分享到新浪微博"
				}, {
					title: "分享到腾讯微博"
				}, {
					title: "分享到QQ"
				}];
			plus.nativeUI.actionSheet({
				cancel: "取消",
				buttons: bts
			}, function(e) {
				var i = e.index;
				if (i > 0) {
					var s_id = ids[i - 1].id;
					var share = shares[s_id];
					if (share) {
						if (share.authenticated) {
							shareMessage(share, ids[i - 1].ex);
						} else {
							share.authorize(function() {
								shareMessage(share, ids[i - 1].ex);
							}, function(e) {
								console.log("认证授权失败：" + e.code + " - " + e.message);
							});
						}
					} else {
						mui.toast("无法获取分享服务，请检查manifest.json中分享插件参数配置，并重新打包")
					}
				}
			});
		});

		function shareMessage(share, ex) {
				var msg = {
					extra: {
						scene: ex
					}
				};
				msg.href = "http://www.dcloud.io/hellomui/";
				msg.title = "最接近原生APP体验的高性能前端框架";
				msg.content = "我正在体验HelloMUI，果然很流畅，基本看不出和原生App的差距";
				if (~share.id.indexOf('weibo')) {
					msg.content += "；体验地址：http://www.dcloud.io/hellomui/";
				}
				msg.thumbs = ["_www/images/logo.png"];
				share.send(msg, function() {
					console.log("分享到\"" + share.description + "\"成功！ ");
				}, function(e) {
					console.log("分享到\"" + share.description + "\"失败: " + e.code + " - " + e.message);
				});
			}
			//去评分
		document.getElementById("rate").addEventListener('tap', function() {
			if (mui.os.ios) {
				location.href = 'https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?id=682211190&pageNumber=0&sortOrdering=2&type=&mt=8';
			} else if (mui.os.android) {
				plus.runtime.openURL("market://details?id=io.dcloud.HelloMUI", function(e) {
					plus.runtime.openURL("market://details?id=io.dcloud.HelloMUI", function(e) {
						mui.alert("360手机助手和应用宝，你一个都没装，暂时无法评分，感谢支持");
					}, "com.qihoo.appstore");
				}, "com.tencent.android.qqdownloader");
			}
		});
		 //客服电话
		document.getElementById("tel").addEventListener('tap', function() {
			plus.device.dial("114");
		});
		 //		//意见反馈
		 //		document.getElementById("quest").addEventListener('tap', function() {
		 //			
		 //		});
		 //		
		 //检查更新
		document.getElementById("update").addEventListener('tap', function() {
			var server = "http://www.dcloud.io/check/update"; //获取升级描述文件服务器地址
			mui.getJSON(server, {
				"appid": plus.runtime.appid,
				"version": plus.runtime.version,
				"imei": plus.device.imei
			}, function(data) {
				if (data.status) {
					plus.ui.confirm(data.note, function(i) {
						if (0 == i) {
							plus.runtime.openURL(data.url);
						}
					}, data.title, ["立即更新", "取　　消"]);
				} else {
					mui.toast('茂号已是最新版本~')
				}
			});
		});
		var view = viewApi.view;
		(function($) {
			//处理view的后退与webview后退
			var oldBack = $.back;
			$.back = function() {
				if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
					viewApi.back();
				} else { //执行webview后退
					oldBack();
				}
			};
			//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
			//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
			view.addEventListener('pageBeforeShow', function(e) {
				//				console.log(e.detail.page.id + ' beforeShow');
			});
			view.addEventListener('pageShow', function(e) {
				//				console.log(e.detail.page.id + ' show');
			});
			view.addEventListener('pageBeforeBack', function(e) {
				//				console.log(e.detail.page.id + ' beforeBack');
			});
			view.addEventListener('pageBack', function(e) {
				//				console.log(e.detail.page.id + ' back');
			});
		})(mui);
		 //更换头像
		mui(".mui-table-view-cell").on("tap", "#head", function(e) {
			var a = [{
				title: "拍照"
			}, {
				title: "从手机相册选择"
			}];
			plus.nativeUI.actionSheet({
				title: "修改头像",
				cancel: "取消",
				buttons: a
			}, function(b) {
				switch (b.index) {
					case 0:
						break;
					case 1:
						getImage();
						break;
					case 2:
						galleryImg();
						break;
					default:
						break
				}
			})
		});

		function getImage() {
			var c = plus.camera.getCamera();
			c.captureImage(function(e) {
				plus.io.resolveLocalFileSystemURL(e, function(entry) {
					var s = entry.toLocalURL() + "?version=" + new Date().getTime();
					console.log(s);
					document.getElementById("head-img").src = s;
					document.getElementById("head-img1").src = s;
					//变更大图预览的src
					//目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现
					document.querySelector("#__mui-imageview__group .mui-slider-item img").src = s + "?version=" + new Date().getTime();;;
				}, function(e) {
					console.log("读取拍照文件错误：" + e.message);
				});
			}, function(s) {
				console.log("error" + s);
			}, {
				filename: "_doc/head.jpg"
			})
		}

		function galleryImg() {
			plus.gallery.pick(function(a) {
				plus.io.resolveLocalFileSystemURL(a, function(entry) {
					plus.io.resolveLocalFileSystemURL("_doc/", function(root) {
						root.getFile("head.jpg", {}, function(file) {
							//文件已存在
							file.remove(function() {
								entry.copyTo(root, 'head.jpg', function(e) {
										var e = e.fullPath + "?version=" + new Date().getTime();
										document.getElementById("head-img").src = e;
										document.getElementById("head-img1").src = e;
										//变更大图预览的src
										//目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现
										document.querySelector("#__mui-imageview__group .mui-slider-item img").src = e + "?version=" + new Date().getTime();;
									},
									function(e) {
										console.log('copy image fail:' + e.message);
									});
							}, function() {
								console.log("delete image fail:" + e.message);
							});
						}, function() {
							//文件不存在
							entry.copyTo(root, 'head.jpg', function(e) {
									var path = e.fullPath + "?version=" + new Date().getTime();
									document.getElementById("head-img").src = path;
									document.getElementById("head-img1").src = path;
									//变更大图预览的src
									//目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现
									document.querySelector("#__mui-imageview__group .mui-slider-item img").src = path;
								},
								function(e) {
									console.log('copy image fail:' + e.message);
								});
						});
					}, function(e) {
						console.log("get _www folder fail");
					})
				}, function(e) {
					console.log("读取拍照文件错误：" + e.message);
				});
			}, function(a) {}, {
				filter: "image"
			})
		};

		function defaultImg() {
			plus.io.resolveLocalFileSystemURL("_doc/head.jpg", function(entry) {
				var s = entry.fullPath + "?version=" + new Date().getTime();;
				document.getElementById("head-img").src = s;
				document.getElementById("head-img1").src = s;
			}, function(e) {
				document.getElementById("head-img").src = '../images/logo.png';
				document.getElementById("head-img1").src = '../images/logo.png';
			})
		}
		document.getElementById("head-img1").addEventListener('tap', function(e) {
			e.stopPropagation();
		});
		document.getElementById("welcome").addEventListener('tap', function(e) {
			//显示启动导航
			mui.openWindow({
				id: 'guide',
				url: 'guide.html',
				show: {
					aniShow: 'fade-in',
					duration: 300
				},
				waiting: {
					autoShow: false
				}
			});
		});
		
		//切换收藏
		mui('#scroll').scroll({
			indicators: true //是否显示滚动条
		});
		var segmentedControl = document.getElementById('segmentedControl');
		mui('.mui-input-group').on('change', 'input', function() {
			if (this.checked) {
				var styleEl = document.querySelector('input[name="style"]:checked');
				var colorEl = document.querySelector('input[name="color"]:checked');
				if (styleEl && colorEl) {
					var style = styleEl.value;
					var color = colorEl.value;
					segmentedControl.className = 'mui-segmented-control' + (style ? (' mui-segmented-control-' + style) : '') + ' mui-segmented-control-' + color;
				}
			}
		});
		//收藏删除
		var btnArray = ['确认', '取消'];
		mui('#OA_task_1').on('tap', '.mui-btn.mui-icon-trash', function(event) {
			var elem = this;
			mui.confirm('确认删除该条记录？', '提示', btnArray, function(e) {
				if (e.index == 0) {
					var li = elem.parentNode.parentNode;
					li.parentNode.removeChild(li);
				}
			});
		});
		mui('#OA_task_2').on('tap', '.mui-btn.mui-icon-trash', function(event) {
			var elem = this;
			mui.confirm('确认删除该条记录？', '提示', btnArray, function(e) {
				if (e.index == 0) {
					var li = elem.parentNode.parentNode;
					li.parentNode.removeChild(li);
				}
			});
		});
		
		//退出操作
		var settings = app.getSettings();
		document.getElementById('exit').addEventListener('tap', function() {
			settings.autoLogin = false;
			app.setSettings(settings);
			app.setState({});
			mui.openWindow({
				url: '../login.html',
				id: 'login',
				show: {
					aniShow: 'pop-in'
				},
				styles: {
					popGesture: 'hide'
				},
				waiting: {
					autoShow: true
				}
			});
		}, false);

		function initImgPreview() {
			var imgs = document.querySelectorAll("img.mui-action-preview");
			imgs = mui.slice.call(imgs);
			if (imgs && imgs.length > 0) {
				var slider = document.createElement("div");
				slider.setAttribute("id", "__mui-imageview__");
				slider.classList.add("mui-slider");
				slider.classList.add("mui-fullscreen");
				slider.style.display = "none";
				slider.addEventListener("tap", function() {
					slider.style.display = "none";
				});
				slider.addEventListener("touchmove", function(event) {
					event.preventDefault();
				})
				var slider_group = document.createElement("div");
				slider_group.setAttribute("id", "__mui-imageview__group");
				slider_group.classList.add("mui-slider-group");
				imgs.forEach(function(value, index, array) {
					//给图片添加点击事件，触发预览显示；
					value.addEventListener('tap', function() {
						slider.style.display = "block";
						_slider.refresh();
						_slider.gotoItem(index, 0);
					})
					var item = document.createElement("div");
					item.classList.add("mui-slider-item");
					var a = document.createElement("a");
					var img = document.createElement("img");
					img.setAttribute("src", value.src);
					a.appendChild(img)
					item.appendChild(a);
					slider_group.appendChild(item);
				});
				slider.appendChild(slider_group);
				document.body.appendChild(slider);
				var _slider = mui(slider).slider();
			}
		}
	</script>

</html>