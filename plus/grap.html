<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../css/bootstrap-theme.min.css" />
		<link rel="stylesheet" href="../css/font-awesome.min.css" />
		<link rel="stylesheet" href="../css/style.css" />
		<link rel="stylesheet" href="../css/mui.indexedlist.css" />
		<script>
			function imgLoaded(img) {
        var imgWrapper = img.parentNode;
        imgWrapper.className += imgWrapper.className? ' loaded' : 'loaded';
      }
			
		</script>
	</head>

	<body class="niceui">
		<header class="mui-bar mui-bar-nav">
			<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav"></span>返回
			</button>
			<h1 class="mui-center mui-title">抢优惠</h1>
			<button type="button" id="heart" status="0" class="mui-pull-right mui-btn-link" style="font-size: 12px; padding-right: 2px;"><i class="fa fa-heart-o fa-2x"></i></button>
		</header>
		<div class="mui-content" id="content">
			<div class="mui-scroll-wrapper" style="padding-top: 60px;">
				<div class="mui-scroll">
					<div class="container">
						<div class="row" id="post-list">
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type" id="1">抢</span>
					        <span class="name" id="merchant.html?shop=1" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="count">剩<span class="badge">500</span>张</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type" id="1">抢</span>
					        <span class="name" id="merchant.html?shop=2" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="count">剩<span class="badge">500</span>张</span>
					        <span class="price"><span class="h4"></span>7折</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type" id="1">抢</span>
					        <span class="name" id="merchant.html?shop=3" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="count">剩<span class="badge">500</span>张</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
							<div class="col-xs-12 col-sm-6">
						    <article class="post tag-ad collect danger">
					        <div class="post-featured-image"></div>
					        <span class="type" id="1">抢</span>
					        <span class="name" id="merchant.html?shop=4" onclick="clicked(this.id);">肯德基(大新店)</span>
					        <span class="time">&nbsp;09-09&nbsp;10:10</span>
					        <span class="count">剩<span class="badge">500</span>张</span>
					        <span class="price"><span class="h4">￥</span>100</span>
					        <span class="description">满100使用</span>
					        <span class="dash"></span>
					        <span class="stop top"></span>
					        <span class="stop bottom"></span>
						    </article>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/mui.indexedlist.js"></script>
		<script type="text/javascript" charset="utf-8">
			//初始化单页的区域滚动
			mui('.mui-scroll-wrapper').scroll();
			mui.init();
			var as='pop-in';// 默认窗口动画
			// 处理点击事件
			var _openw=null;
			function clicked(id,a,s){
				if(_openw){return;}
				a||(a=as);
				_openw=preate[id];
				if(_openw){
					_openw.showded=true;
					_openw.show(a,null,function(){
						_openw=null;//避免快速点击打开多个页面
					});
				}else{
					var wa=plus.nativeUI.showWaiting();
					_openw=plus.webview.create(id,id,{scrollIndicator:'none',scalable:false,popGesture:'hide'},{preate:true});
					preate[id]=_openw;
					_openw.addEventListener('loaded',function(){//叶面加载完成后才显示
						setTimeout(function(){//延后显示可避免低端机上动画时白屏
							wa.close();
							_openw.showded=true;
							s||_openw.show(a,null,function(){
								_openw=null;//避免快速点击打开多个页面
							});
							s&&(_openw=null);//避免s模式下变量无法重置
						},10);
					},false);
					_openw.addEventListener('close',function(){//页面关闭后可再次打开
						_openw=null;
						preate[id]&&(preate[id]=null);//兼容窗口的关闭
					},false);
				}
			}
			// 预创建二级页面
			var preate={};
			function preateWebviews(){
				preateWebivew('plus/grap.html');
				var plist=document.getElementById('plist').children;
				// 由于启动是预创建过多Webview窗口会消耗较长的时间，所以这里限制仅创建5个
				for( var i=0;i<plist.length&&i<2;i++){
					var id=plist[i].id;
					id&&(id.length>0)&&preateWebivew(id);
				}
			}
			function preateWebivew(id){
				if(!preate[id]){
					var w=plus.webview.create(id,id,{scrollIndicator:'none',scalable:false,popGesture:'hide'},{preate:true});
					preate[id]=w;
					w.addEventListener('close',function(){//页面关闭后可再次打开
						_openw=null;
						preate[id]&&(preate[id]=null);//兼容窗口的关闭
					},false);
				}
			}
			// 清除预创建页面(仅)
			function preateClear(){
				for(var p in preate){
					var w=preate[p];
					if(w&&w.showded&&!w.isVisible()){
						w.close();
						preate[p]=null;
					}
				}
			}
			mui.plusReady(function() {
				// H5 plus事件处理
				function plusReady(){
					// 隐藏滚动条
					plus.webview.currentWebview().setStyle({scrollIndicator:'none'});
					// Android处理返回键
					
					compatibleAdjust();
				}
				if(window.plus){
					plusReady();
				}else{
					document.addEventListener('plusready',plusReady,false);
				}
				// DOMContentLoaded事件处理
				var _domReady=false;
				document.addEventListener('DOMContentLoaded',function(){
					_domReady=true;
					compatibleAdjust();
				},false);
				var _adjust=false;
				function compatibleAdjust(){
					if(_adjust||!window.plus||!_domReady){
						return;
					}
					_adjust=true;

					// 预创建二级窗口
				//	preateWebviews();
					// 关闭启动界面
					setTimeout(function(){
						plus.navigator.closeSplashscreen();
					},500);
				}
				var heart = document.getElementById('heart');
				heart.addEventListener('click', function(event){
					if (heart.status == 0){
						heart.status = 1;
						heart.innerHTML = "<i class='fa fa-heart-o fa-2x'></i>";
						plus.nativeUI.toast('已取消收藏！');
					} else {
						heart.status = 0;
						heart.innerHTML = "<i class='fa fa-heart fa-2x'></i>";
						plus.nativeUI.toast('收藏成功！');
					}
				});
				//抢券
				mui('#post-list').on('tap', '.collect .type', function(event) {
					var elem = this;
					if(elem.innerText!="已抢" && elem.innerText!="未开始" && elem.innerText!="已抢完"){
						elem.className = elem.className.replace("badge-danger", "badge-success");
						var parent = elem.parentNode;
						parent.className = parent.className.replace("danger", "success");
						elem.innerText = "已抢";
						plus.nativeUI.toast('抢券成功！');
					}
				});
			});
		</script>
	</body>

</html>